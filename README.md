# C++语言程序设计

《C++语言程序设计》

作者：郑莉 董渊 何江舟

清华大学出版社，2019年出版

## 第四章 类和对象

### 4.1 面向对象程序设计的基本特点

- 抽象：是指对具体问题进行概括，抽象出一类对象的公共属性并加以描述的过程。
  - 数据抽象
  - 行为抽象
- 封装：将抽象到的数据和行为相结合，形成一个有机的整体。
- 继承：在保持原有类特性的基础上，进行更详细的说明。
- 多态：一段程序能处理多种类型对象的能力。
  - 强制多态
  - 重载多态
  - 类型参数化多态
  - 包含多态

### 4.2 类和对象

#### 4.2.1 类的定义
在面向对象程序设计过程中，程序模块是由类构成的。类是对逻辑上相关的函数与数据的封装，它是对问题的抽象描述。其语法形式如下：
```text
class  类名
{
public:
	外部接口
protected:
	保护型成员
private:
	私有成员
};
```

#### 4.2.1 类成员的访问控制

- 共有类型：定义了外部接口。

- 私有类型：只能被**类内成员函数**访问，类外部任何访问都是**非法的**。

- 保护类型：和私有成员性质类似，差别在于继承过程中对**新类**的影响。

> 数据成员应该声明为私有，在书写时公有成员写在最前面。

#### 4.2.3 对象
声明对象 

```text
类名 对象名
```
> 对象所占的内存空间只用于存储**数据成员**，函数成不在每个对象中存放副本，只占据一份空间。

访问数据成员
```text
对象名.数据成员
```

访问函数成员
```text
对象名.函数成员
```
#### 4.2.4 类的成员函数
1.成员函数的实现
函数的原型声明要写在类体中，原型说明了函数的参数表和返回值类型。而函数的具体实现是写在类定义之外的。与普通函数不同的是，实现成员函数时要指明类的名称，具体形式为：

```text
返回值类型 类名：：函数成员名（参数表）
{
	函数体
}
```
2.成员函数调用中的目的对象
调用一个成员函数与调用普通函数的差异在于，需要使用“.”操作符指出调用所针对的对象，这一对象在本次调用中称为目的对象。

3.带默认形参值的成员函数
类成员函数的默认值，一定要写在**类定义中**，而不能写在类定义之外的函数实现中。

4.内联函数成员
内联函数的声明有两种方式：隐式声明和显式声明。
- 将函数体直接放在类体内，这种方法称之为隐式声明。
- 为了保证类定义的简洁，可以采用关键字**inline**显式声明的方式。

### 4.3 构造函数与析构函数
在定义对象的时候进行的数据成员设置，称为对象的初始化。C++程序中的初始化和清理工作，分别由两个特殊的成员函数来完成，他们就是构造函数和析构函数。

#### 4.3.1 构造函数
构造函数的作用就是在对象被创建时利用特定的值构造对象，将对象初始化为一个特定的状态。
```text
class 类名{
public:
	类名();
};
```
构造函数也是一个类的成员函数，除了具有一般成员函数的特征之外，还有以下特殊的性质：
- 构造函数的函数名与类名相同。
- 没有返回值
- 其通常被声明为公有函数。

只要类中有构造函数，编译器就会在建立新对象的地方自动插入对构造函数调用的代码，即构造函数在对象被创建的时候将被**自动调用**。构造函数可以是直接访问所有的数据成员，可以是内联函数，可以带有参数表，可以带默认值，可以重载。

无需提供参数的构造函数称为默认构造函数，如果没写构造函数，系统默认生成一个隐含的构造函数，参数列表和函数体均为空。 如果定义了构造函数，编译器不会生成隐含的默认构造函数。


#### 4.3.2 复制构造函数
复制构造函数是一种特殊的构造函数，具有一般构造函数的所有特性，其形参是本类对象的引用，其作用是使用一个已经存在的对象（由复制构造函数的参数指定），去初始化同类的一个新对象。语法形式如下：
```text
class 类名{
public:
	类名();
    类名(类名 &对象);
};
```
如果没有定义类的构造函数，系统会自动生成一个隐含的复制构造函数，这个隐含的复制构造函数的作用是把初始值对象的每一个数据成员的值都复制到新建立的对象。

复制构造函数在以下情况会被默认调用
```c++
//函数形参是类的对象
void fun1(Point p)
{
	cout << p.getX() << endl;
}
//函数返回值是类的对象
Point fun2()
{
	Point a(1, 2);//会消亡
	return a;
}
```

- 用类来初始化该类的另一个对象时
```c++
Point a(4, 5);

// 类的一个对象初始化另一个对象
Point b(a);
Point c = a;
cout << b.getX() << "\t" << c.getX() << endl;//4       4
```
- 函数的形参是类的对象
```c++
//函数形参是类的对象
fun1(b); //4
```
- 函数的返回值是类的对象
```c++
//函数返回值是类的对象
b = fun2();
cout << b.getX() << endl;//1
```
#### 4.3.3 析构函数

析构函数用来完成对象被删除前的一些清理工作。析构函数是在对象生存期即将结束时的时刻被**自动调用**的。析构函数通常也是类的一个公有函数成员，它的名称是由类名前面加“~”构成，没有返回值，且不接收任何参数。其语法形式如下：

```text
class 类名{
public:
	~类名();
};
```
不进行显示说明，系统自动生成一个函数体为空的而隐含析构函数，如果人们希望对象被删除之前时刻西东完成某些事情，就可以将他们把他们写进析构函数中。

### 4.4 类的组合

#### 4.4.1 组合
类的组合描述即使一个类内嵌其他类的对象做为成员。当创建类的时候，如果这个类具有内嵌对象成员，那么这个内嵌对象成员将首先被自动创建。创建对象时，既要对本类的基本数据类型进行初始化，也要对内嵌对象成员进行初始化。其定义形式：

```text
类名::类名(形参表):内嵌对象1(形参表),内嵌对象2(形参表)...
{
	类的初始化
}
```
> 其中 内嵌对象1(形参表),内嵌对象2(形参表)... 被称为初始化列表，可以对内嵌对象初始化


构造函数的调用顺序如下：

调用内嵌对象的构造函数，调用顺序按照**内嵌对象在组合类中的定义中出现的次序**。内嵌对象在构造函数的初始化列表中出现的顺序与内嵌对象构造函数的调用顺序**无关**。执行本类构造函数的函数体。析构函数的执行顺序与构造函数刚好相反

### 4.6 结构体和联合体

#### 4.6.1 结构体

结构体是一种特殊形态的类。结构体和类的唯一区别在于，结构体和类具有不同的默认访问控制属性：在类中，对于未指定访问控制属性的成员，其访问控制属性为**私有类型**；在结构体中，对于未指定访问控制属性的成员，其访问控制属性为**公有类型**。

#### 4.6.2 联合体

联合体是一种特殊形态的类。它可以有自己的数据成员和函数成员，与结构体一样也是从C语言继承过来的。联合体的全部数据成员**共享同一组内存单元**。